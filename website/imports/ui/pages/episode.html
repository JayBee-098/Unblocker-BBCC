<template name="pages_episode">
  <div class="container">
    {{#each iframeError in iframeErrors}}
      {{#if $eq iframeError 'cloudflare'}}
        <ul class="collection with-header">
          <li class="collection-header">
            <h4>Disable the Cloudflare filter once to watch this video.</h4>
          </li>
          <li class="collection-item">
            You will have to wait for this to complete:<br>
            <img class="disable-cloudflare-filter-image" src="/media/images/cloudflare-challenge-simple.png">
          </li>
          <li class="collection-item">
            <a href="{{selectedEpisode.streamer.homepage}}" target="_blank">Click here to disable the filter.</a>
            <strong>Return here</strong> once the loading is done.
          </li>
          <li class="collection-item">Close the new tab and reload this page once the filter is disabled.</li>
        </ul>
      {{/if}}
      {{#if $eq iframeError 'mixed-content'}}
        <ul class="collection with-header">
          <li class="collection-header">
            <h4>Disable mixed content protection to watch this video.</h4>
          </li>
          <li class="collection-item {{#unless $eq $.BrowserDetect.browser 'Firefox'}}removed{{/unless}}">
            Firefox:<br>
            <img class="disable-mixed-protection-image" src="/media/images/firefox-unsafe-1.png">
            <img class="disable-mixed-protection-image" src="/media/images/firefox-unsafe-2.png">
          </li>
          <li class="collection-item {{#unless $eq $.BrowserDetect.browser 'Chrome'}}removed{{/unless}}">
            Chrome:<br>
            <img class="disable-mixed-protection-image" src="/media/images/chrome-unsafe-1.png">
            <img class="disable-mixed-protection-image" src="/media/images/chrome-unsafe-2.png">
          </li>
        </ul>
      {{/if}}
      {{#if $eq iframeError 'flash'}}
        <ul class="collection with-header">
          <li class="collection-header">
            <h4>This video requires Adobe Flash Player to be played.</h4>
          </li>
          <li class="collection-item"><a href="https://get.adobe.com/flashplayer/" target="_blank">You can get it here.</a></li>
          <li class="collection-item">Make sure to uncheck the optional offers.</li>
        </ul>
      {{/if}}
      {{#if $eq iframeError 'x-frame-options'}}
        <ul class="collection with-header">
          <li class="collection-header">
            <h4>This video cannot be watched without the companion browser add-on.</h4>
          </li>
        </ul>
      {{/if}}
    {{/each}}

    <ul class="collection {{#if iframeErrors}}removed{{/if}}">
      <li class="collection-item" id="player-container-collection">
        <div id="player-container-outer">
          <div id="player-container-inner">
            <iframe id="episode-frame" src="{{selectedSource.url}}"></iframe>
          </div>
        </div>
      </li>
      <li class="collection-item">
        <a class="waves-effect waves-light btn not-working-btn">Video not working?</a>
        Try another video first.
      </li>
    </ul>

    {{#each episode in episodes}}
      <ul class="collection with-header">
        <li class="collection-header">
          <h5>{{episode.streamer.name}}</h5>
        </li>
        <li class="collection-item">
          {{#each source in episode.sources}}
            <a class="waves-effect waves-light btn source-btn {{#if flagsDisabled source.flags}}disabled{{/if}} {{#if $eq selectedSource.name source.name}}{{#if $eq selectedEpisode._id episode._id}}primary-color{{/if}}{{/if}}" data-episode="{{episode._id}}" data-source="{{source.name}}">
              {{source.name}}
              {{#each flag in source.flags}}
                {{#if showIcon flag}}
                  {{#if $eq flag 'x-frame-options'}}
                    {{>tooltippedIcon icon='block' iconClass='right' text='Abuses X-Frame-Options' position='right'}}
                  {{/if}}
                  {{#if $eq flag 'cloudflare'}}
                    {{>tooltippedIcon icon='cloud_off' iconClass='right' text='Uses Cloudflare Filtering' position='right'}}
                  {{/if}}
                  {{#if $eq flag 'mixed-content'}}
                    {{>tooltippedIcon icon='lock_open' iconClass='right' text='Has Mixed Content' position='right'}}
                  {{/if}}
                  {{#if $eq flag 'flash'}}
                    {{>tooltippedIcon icon='flash_off' iconClass='right' text='Uses Flash Player' position='right'}}
                  {{/if}}
                {{/if}}
              {{/each}}
            </a>
          {{/each}}
        </li>
      </ul>
    {{/each}}
  </div>

  {{> components_loading_indicator_background state=updating}}
</template>
